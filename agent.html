<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gabbar Gemini Agent</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body { background: #080808; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; padding: 20px; display: flex; justify-content: center; }
        .panel { width: 100%; max-width: 500px; background: #121212; border: 1px solid #333; padding: 30px; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.7); }
        h2 { color: #4285F4; text-align: center; } /* Gemini Blue */
        input { width: 100%; padding: 14px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: #fff; border-radius: 10px; box-sizing: border-box; }
        button { background: #4285F4; color: #fff; border: none; padding: 16px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #34a853; } /* Turns green on hover */
        #log-window { margin-top: 20px; background: #000; height: 250px; overflow-y: auto; padding: 15px; font-family: monospace; font-size: 11px; border: 1px solid #222; border-radius: 10px; color: #00ff88; line-height: 1.5; }
    </style>
</head>
<body>

<div class="panel">
    <div id="setup-ui">
        <h2>üöÄ Unlock Gemini Agent</h2>
        <input type="password" id="gemini_key" placeholder="Paste Gemini API Key (AIza...)">
        <input type="password" id="hf_keys" placeholder="Paste HF Keys (comma separated)">
        <button onclick="unlock()">INITIALIZE SYSTEM</button>
    </div>

    <div id="main-ui" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="color:#4285F4">Chic Daily Production</h3>
            <span id="count-display" style="font-size:20px; font-weight:bold;">0/25</span>
        </div>
        <button id="run-btn" onclick="startProduction()">üî• START 25 POSTS BATCH</button>
        <div id="log-window">Gemini Engine Standby...</div>
    </div>
</div>

<script>
    let KEYS = { gemini: "", hf: [], currentHF: 0 };
    const zip = new JSZip();
    let csvData = "image_name,caption\n";

    function unlock() {
        const gem = document.getElementById('gemini_key').value.trim();
        const hf = document.getElementById('hf_keys').value.trim();
        if(gem && hf) {
            KEYS.gemini = gem;
            KEYS.hf = hf.split(',').map(k => k.trim());
            document.getElementById('setup-ui').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
            log("System Authenticated via Google AI Studio.");
        } else { alert("Please provide both API keys."); }
    }

    function log(msg, color = "#00ff88") {
        const win = document.getElementById('log-window');
        win.innerHTML += `<div style="color:${color}">> ${msg}</div>`;
        win.scrollTop = win.scrollHeight;
    }

    async function geminiCall(prompt) {
        try {
            const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${KEYS.gemini}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const d = await r.json();
            return d.candidates[0].content.parts[0].text;
        } catch (e) { return "error"; }
    }

    async function fluxCall(prompt) {
        const key = KEYS.hf[KEYS.currentHF];
        KEYS.currentHF = (KEYS.currentHF + 1) % KEYS.hf.length;
        const r = await fetch("https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-schnell", {
            headers: { Authorization: `Bearer ${key}` },
            method: "POST",
            body: JSON.stringify({ inputs: prompt + " | high-end luxury streetwear, cinematic" }),
        });
        return await r.blob();
    }

    async function startProduction() {
        document.getElementById('run-btn').disabled = true;
        log("Gemini is analyzing USA 2026 trends...", "#4285F4");
        
        try {
            const trends = ["Luxury Cyberpunk", "Techwear Streetstyle", "Quiet Luxury NYC", "Vintage Grunge 2026", "Sustainable High-Fashion"];
            let total = 0;

            for (let trend of trends) {
                log(`Trend Spotted: ${trend}`, "#fff");
                for (let i = 0; i < 5; i++) {
                    total++;
                    document.getElementById('count-display').innerText = `${total}/25`;
                    
                    const content = await geminiCall(`Create a viral FB post and image prompt for: ${trend}. Use format: [C]caption[P]prompt`);
                    if(content === "error" || !content.includes('[P]')) continue;

                    const parts = content.split('[P]');
                    const caption = parts[0].replace('[C]', '').trim();
                    const prompt = parts[1].trim();

                    log(`Generating Image ${total}...`, "#888");
                    const imgBlob = await fluxCall(prompt);
                    
                    const fileName = `chic_${total}.jpg`;
                    zip.file(fileName, imgBlob);
                    csvData += `"${fileName}","${caption.replace(/"/g, '""')}"\n`;
                    
                    log(`‚úÖ Post ${total} Stored in Buffer.`);
                    await new Promise(r => setTimeout(r, 1500)); // Rate limiting safety
                }
            }

            log("Assembling All Assets into ZIP...", "#4285F4");
            zip.file("meta_upload.csv", csvData);
            const content = await zip.generateAsync({type:"blob"});
            const a = document.createElement("a");
            a.href = URL.createObjectURL(content);
            a.download = "ChicDaily_Gemini_Batch.zip";
            a.click();
            log("üèÅ ALL DONE. DOWNLOAD STARTED.");

        } catch (e) { log("CRITICAL ERROR: " + e.message, "#ff4444"); }
        document.getElementById('run-btn').disabled = false;
    }
</script>
</body>
</html>
