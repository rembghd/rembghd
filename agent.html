<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gabbar Agent - Chic Daily</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body { background: #050505; color: #e2e8f0; font-family: 'Inter', sans-serif; padding: 20px; }
        .panel { max-width: 700px; margin: auto; background: #111; border: 1px solid #222; padding: 25px; border-radius: 12px; border-top: 4px solid #00ff88; }
        #log-window { margin-top: 20px; background: #000; height: 350px; overflow-y: auto; padding: 15px; font-size: 12px; border: 1px solid #333; color: #adbac7; line-height: 1.5; }
        button { background: #fff; color: #000; border: none; padding: 18px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
        button:hover { background: #00ff88; }
        button:disabled { background: #222; color: #555; cursor: not-allowed; }
        .post-count { float: right; color: #00ff88; font-weight: bold; }
    </style>
</head>
<body>

<div class="panel">
    <h2 style="margin:0">Gabbar Agent: Chic Daily <span class="post-count" id="counter">0/50</span></h2>
    <p style="color:#666; font-size:13px">Niche: USA High-End Street Fashion | 3-Key Rotation</p>
    
    <button id="start-btn" onclick="startProduction()">ðŸš€ Start 50 Posts Production</button>

    <div id="log-window">System Ready. Awaiting Gabbar's Command...</div>
</div>

<script>
    const HF_KEYS = [
        "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",
        "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",
        "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"
    ];
    const GROQ_KEY = "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";
    let keyIdx = 0;
    const zip = new JSZip();
    let csvData = "image_name,caption\n";

    function writeLog(msg, color = "#adbac7") {
        const log = document.getElementById('log-window');
        log.innerHTML += `<div style="color:${color}">${new Date().toLocaleTimeString()} - ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    async function fetchFromGroq(prompt) {
        const resp = await fetch("https://api.groq.com/openai/v1/chat/completions", {
            method: "POST",
            headers: { "Authorization": `Bearer ${GROQ_KEY}`, "Content-Type": "application/json" },
            body: JSON.stringify({
                model: "llama-3.1-70b-versatile",
                messages: [{role: "user", content: prompt}],
                temperature: 0.7
            })
        });
        const data = await resp.json();
        return data.choices[0].message.content;
    }

    async function generateImage(prompt, index) {
        const currentKey = HF_KEYS[keyIdx];
        keyIdx = (keyIdx + 1) % HF_KEYS.length; // Rotate keys

        const response = await fetch("https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-schnell", {
            headers: { Authorization: `Bearer ${currentKey}` },
            method: "POST",
            body: JSON.stringify({ inputs: prompt + " | 4k realistic photographic, high fashion model, street style, sharp focus" }),
        });
        const blob = await response.blob();
        return blob;
    }

    async function startProduction() {
        document.getElementById('start-btn').disabled = true;
        writeLog("Starting Chic Daily Engine...", "#fff");

        try {
            // Step 1: Get Trends from Groq
            writeLog("Scouting USA High-End Fashion Trends...", "#00ff88");
            const trendsRaw = await fetchFromGroq("List 10 current high-end street fashion trends in USA for 2026. Give only the list names separated by commas.");
            const trends = trendsRaw.split(',').map(t => t.trim());

            let count = 0;
            for (let trend of trends) {
                writeLog(`Working on Trend: ${trend}`, "#3b82f6");
                
                for (let i = 1; i <= 5; i++) {
                    count++;
                    document.getElementById('counter').innerText = `${count}/50`;
                    
                    // Get Caption & Prompt for this specific post
                    const content = await fetchFromGroq(`Trend: ${trend}. Write a viral Facebook caption (long) and a 1-sentence image prompt for a realistic photo. Format: [CAPTION]...[PROMPT]...`);
                    const [caption, imagePrompt] = content.split('[PROMPT]');
                    
                    // Generate Image
                    const imgBlob = await generateImage(imagePrompt || trend, count);
                    
                    // Add to ZIP and CSV
                    const fileName = `chic_post_${count}.jpg`;
                    zip.file(fileName, imgBlob);
                    csvData += `"${fileName}","${caption.replace('[CAPTION]', '').replace(/"/g, '""')}"\n`;
                    
                    writeLog(`Post ${count} Ready (Key ${keyIdx + 1})`, "#aaa");
                    await new Promise(r => setTimeout(r, 1000)); // Buffer
                }
            }

            // Step 4: Finalize
            writeLog("Generating Master ZIP...", "#fff");
            zip.file("meta_schedule.csv", csvData);
            const zipBlob = await zip.generateAsync({type:"blob"});
            const url = window.URL.createObjectURL(zipBlob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `ChicDaily_Batch_${new Date().toLocaleDateString()}.zip`;
            a.click();
            
            writeLog("âœ… BATCH COMPLETE! Downloaded.", "#00ff88");

        } catch (error) {
            writeLog("CRITICAL ERROR: " + error.message, "red");
        }
        document.getElementById('start-btn').disabled = false;
    }
</script>

</body>
</html>
