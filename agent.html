<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SADSHA PRO | ZIP FINAL FIX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { --bg: #0b1120; --card: #111827; --yellow: #fbbf24; --border: #1f2937; --green: #10b981; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; padding: 20px; }
        .card { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 15px; max-width: 800px; margin: 0 auto; }
        label { display: block; font-size: 11px; color: var(--yellow); font-weight: 800; margin-bottom: 8px; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 12px; background: var(--bg); border: 1px solid var(--border); color: #fff; border-radius: 8px; margin-bottom: 15px; }
        .btn-main { width: 100%; padding: 18px; background: var(--yellow); color: #000; border: none; border-radius: 10px; font-weight: 900; cursor: pointer; text-transform: uppercase; }
        .terminal { background: #000; color: var(--green); font-family: monospace; padding: 15px; height: 200px; overflow-y: auto; font-size: 12px; border: 1px solid var(--border); border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="color:var(--yellow)">SADSHA <span style="color:#fff">PRODUCTION</span></h2>
    
    <label>Gemini API Key</label>
    <input type="password" id="text-key" placeholder="Enter Gemini Key">

    <label>Hugging Face Keys (Rotation)</label>
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
        <input type="password" class="hf-key" placeholder="Key 1">
        <input type="password" class="hf-key" placeholder="Key 2">
        <input type="password" class="hf-key" placeholder="Key 3">
    </div>

    <label>Custom Instruction</label>
    <textarea id="custom-p" style="height:60px;">Fashion model in NYC street style, high-end photography, 8k.</textarea>

    <button class="btn-main" id="launch-btn" onclick="runEngine()">Generate ZIP Package</button>
    <div class="terminal" id="term">Standing by...</div>
</div>

<script>
    function log(m) { const t = document.getElementById('term'); t.innerHTML += `> ${m}<br>`; t.scrollTop = t.scrollHeight; }

    async function queryHF(key, prompt) {
        // Flux model on Hugging Face - High Quality
        const response = await fetch(
            "https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-schnell",
            {
                headers: { Authorization: `Bearer ${key}`, "Content-Type": "application/json" },
                method: "POST",
                body: JSON.stringify({ inputs: prompt }),
            }
        );
        if (!response.ok) throw new Error("HF Key Error");
        return await response.blob();
    }

    async function runEngine() {
        const textKey = document.getElementById('text-key').value;
        const hfKeys = Array.from(document.querySelectorAll('.hf-key')).map(i => i.value).filter(v => v !== "");
        const zip = new JSZip();
        let csvContent = "file_name,caption\n";

        if(!textKey || hfKeys.length === 0) return alert("Please fill all keys!");

        document.getElementById('launch-btn').disabled = true;
        log("Starting Production...");

        // 1. Hardcoded high-quality captions for testing (to bypass Gemini JSON errors for now)
        const captions = [
            "Urban elegance in the heart of NYC", "Street style chic: neutral tones",
            "Modern minimalist fashion vibe", "Sunset photography in fashion week",
            "Editorial look: leather & silk", "Casual luxury: weekend aesthetic",
            "Vintage-inspired high street wear", "Bold patterns for the modern woman",
            "Sleek silhouettes in Manhattan", "Timeless accessories for 'Chic Daily'"
        ];

        for(let i=0; i<10; i++) {
            const currentKey = hfKeys[i % hfKeys.length];
            log(`Post ${i+1}/10: Fetching Image via HF Key ${ (i % hfKeys.length) + 1}...`);
            
            try {
                const imgBlob = await queryHF(currentKey, captions[i] + ", " + document.getElementById('custom-p').value);
                const fileName = `post_${i+1}.jpg`;
                zip.file(fileName, imgBlob);
                csvContent += `${fileName},"${captions[i]}"\n`;
                log(`✓ Post ${i+1} Ready.`);
            } catch (e) {
                log(`× HF Key ${ (i % hfKeys.length) + 1} Failed. Trying next...`);
            }
        }

        zip.file("meta_upload.csv", csvContent);
        log("Compiling ZIP... Please wait.");
        
        const content = await zip.generateAsync({type:"blob"});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(content);
        link.download = "SADSHA_FINAL_BATCH.zip";
        link.click();
        
        log("DONE! Check your Downloads.");
        document.getElementById('launch-btn').disabled = false;
    }
</script>
</body>
</html>
