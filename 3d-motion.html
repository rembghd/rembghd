<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edge AI 3D - RembgHD</title>
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #FFD700; --dark-bg: #0b0f19; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--dark-bg); color: #fff; text-align: center; }
        .container { max-width: 800px; margin: auto; padding: 40px 20px; }
        .upload-box { border: 2px dashed #333; padding: 40px; border-radius: 20px; cursor: pointer; background: #111827; }
        #canvas { width: 100%; max-width: 500px; border-radius: 15px; display: none; margin: 20px auto; border: 2px solid var(--gold); }
        .status { margin: 20px; color: var(--gold); font-weight: 600; }
        .loader { display: none; border: 4px solid #f3f3f3; border-top: 4px solid var(--gold); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 10px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <h1 style="color: var(--gold);">Local Device AI 3D</h1>
    <p>Processing on your device (No Server Needed)</p>

    <div id="setup-status" class="status">Initializing AI Engine...</div>
    <div class="loader" id="loader"></div>

    <div class="upload-box" id="dropZone" style="display:none;" onclick="document.getElementById('fileInput').click()">
        <p>AI Ready. Upload Photo</p>
        <input type="file" id="fileInput" accept="image/*">
    </div>

    <canvas id="canvas"></canvas>
    <div id="output-text" style="margin-top:20px; color:#9ca3af;"></div>
</div>

<script type="module">
    // Transformers.js ko load karna
    import { pipeline, RawImage } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0';

    const status = document.getElementById('setup-status');
    const loader = document.getElementById('loader');
    const dropZone = document.getElementById('dropZone');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let depthEstimator;

    // AI Model load karna (Browser memory mein)
    async function init() {
        loader.style.display = 'block';
        try {
            status.innerText = "Loading AI Model (~15MB)...";
            depthEstimator = await pipeline('depth-estimation', 'Xenova/depth-anything-small');
            status.innerText = "AI Engine Active âœ…";
            loader.style.display = 'none';
            dropZone.style.display = 'block';
        } catch (e) {
            status.innerText = "Error loading AI. Try refreshing.";
        }
    }

    init();

    document.getElementById('fileInput').addEventListener('change', async (e) => {
        const file = e.target.target.files[0];
        if (!file) return;

        status.innerText = "Analyzing 3D Depth...";
        loader.style.display = 'block';

        const url = URL.createObjectURL(file);
        const image = await RawImage.read(url);

        // Actual AI Processing (User ke Mobile/PC par)
        const result = await depthEstimator(image);

        // Depth map ko canvas par draw karna
        const output = result.depth;
        canvas.width = output.width;
        canvas.height = output.height;
        canvas.style.display = 'block';

        const imageData = ctx.createImageData(output.width, output.height);
        for (let i = 0; i < output.data.length; ++i) {
            const val = output.data[i];
            const offset = i * 4;
            imageData.data[offset] = val;
            imageData.data[offset + 1] = val;
            imageData.data[offset + 2] = val;
            imageData.data[offset + 3] = 255;
        }
        ctx.putImageData(imageData, 0, 0);

        status.innerText = "3D Depth Extracted Successfully!";
        loader.style.display = 'none';
    });
</script>

</body>
</html>
