function drawFinal() {
    if (!activeImg || !activeMask) return;
    const s = document.getElementById('sharpener').value;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Step 1: Background Layer (if any)
    if(bgColor !== 'transparent') {
        ctx.fillStyle = bgColor;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    // Step 2: Refined Mask (To fix black edges on arms)
    const mCanvas = document.createElement('canvas');
    mCanvas.width = canvas.width; mCanvas.height = canvas.height;
    const mCtx = mCanvas.getContext('2d');
    
    // Halka sa blur aur contrast edges ko "clean" karta hai
    mCtx.filter = 'blur(0.5px) contrast(1.1)'; 
    mCtx.drawImage(activeMask, 0, 0, canvas.width, canvas.height);

    // Step 3: Drawing the Subject
    const tempCanvas = document.createElement('canvas');
    tempCanvas.width = canvas.width; tempCanvas.height = canvas.height;
    const tCtx = tempCanvas.getContext('2d');
    
    tCtx.drawImage(mCanvas, 0, 0);
    tCtx.globalCompositeOperation = 'source-in';
    
    // Face Restoration & Color Correction
    tCtx.filter = `contrast(${s}) saturate(1.1) brightness(1.02)`;
    tCtx.drawImage(activeImg, 0, 0);

    ctx.drawImage(tempCanvas, 0, 0);
}
