<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RemBghd Ultra HD (30MB Model)</title>
    <style>
        :root { --accent: #00f2fe; --bg: #050a14; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; margin: 0; padding: 20px; text-align: center; }
        .main-card { max-width: 900px; margin: auto; background: #0f172a; padding: 30px; border-radius: 30px; border: 1px solid #1e293b; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px; display: none; }
        .box { background: #070d19; padding: 10px; border-radius: 15px; border: 1px solid #1e293b; }
        img, canvas { max-width: 100%; border-radius: 10px; background-image: conic-gradient(#1e293b 90deg, #0f172a 90deg 180deg, #1e293b 180deg 270deg, #0f172a 270deg); background-size: 20px 20px; }
        #progress-container { margin: 20px 0; display: none; }
        .progress-bar { width: 100%; background: #1e293b; height: 10px; border-radius: 5px; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: var(--accent); transition: width 0.3s; }
        .btn { background: white; color: black; padding: 15px 30px; border-radius: 12px; font-weight: 900; cursor: pointer; border: none; margin-top: 20px; }
    </style>
</head>
<body>

    <h1 style="background: linear-gradient(90deg, #00f2fe, #4facfe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 40px;">ULTRA HD AI</h1>
    
    <div class="main-card">
        <div id="upload-zone" style="border: 2px dashed #334155; padding: 40px; border-radius: 20px; cursor: pointer;">
            <h3>Upload Image</h3>
            <p style="font-size: 12px; color: #64748b;">Note: First time will download ~30MB AI Model for Razor Sharp Quality.</p>
            <input type="file" id="fileIn" hidden accept="image/*">
        </div>

        <div id="progress-container">
            <p id="status">Downloading AI Model...</p>
            <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
        </div>

        <div class="grid" id="previewGrid">
            <div class="box"><p>Before</p><img id="origImg"></div>
            <div class="box"><p>Ultra After</p><canvas id="canvas"></canvas></div>
        </div>
        
        <button id="dlBtn" class="btn" style="display:none;">DOWNLOAD MASTER PNG</button>
    </div>

    <script type="module">
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.14.0';

        const fileIn = document.getElementById('fileIn');
        const progressContainer = document.getElementById('progress-container');
        const progressFill = document.getElementById('progress-fill');
        const status = document.getElementById('status');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let remover;

        async function initAI() {
            status.innerText = "Initializing Ultra Engine...";
            // We use the briaai/Rembg-2.0 model for professional results
            remover = await pipeline('image-segmentation', 'Xenova/modnet', {
                progress_callback: (p) => {
                    progressContainer.style.display = 'block';
                    if(p.status === 'progress') {
                        progressFill.style.width = `${p.progress}%`;
                        status.innerText = `Downloading Model: ${Math.round(p.progress)}%`;
                    }
                }
            });
            status.innerText = "AI Engine Ready!";
        }

        document.getElementById('upload-zone').onclick = () => fileIn.click();

        fileIn.onchange = async (e) => {
            if(!remover) await initAI();
            const file = e.target.files[0];
            if(!file) return;

            const url = URL.createObjectURL(file);
            document.getElementById('origImg').src = url;
            document.getElementById('previewGrid').style.display = 'grid';
            status.innerText = "Processing High-Res Pixels...";

            // Remove Background using the heavy model
            const output = await remover(url);
            
            const img = new Image();
            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(output.mask, 0, 0, canvas.width, canvas.height);
                ctx.globalCompositeOperation = 'source-in';
                ctx.drawImage(img, 0, 0);
                status.innerText = "âœ“ Perfect Cut Finished";
                document.getElementById('dlBtn').style.display = 'inline-block';
            };
            img.src = url;
        };

        document.getElementById('dlBtn').onclick = () => {
            const link = document.createElement('a');
            link.download = 'ultra_hd_rembghd.png';
            link.href = canvas.toDataURL();
            link.click();
        };
    </script>
</body>
</html>
